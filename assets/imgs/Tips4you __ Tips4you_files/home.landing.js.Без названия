/**
 * @author    Daniil V. Deineko <contact@deineko.dev>
 * @copyright Copyright (c) 2017-2020
 */

$(function () {
	"use strict";

	let $app = new App(),
		$ajax = new Ajax(),
		$jquery = $(this);
        

        $jquery.on('click','.header__btn',function(e){
            e.preventDefault();
            $('#checkDomain').addClass('modal__show');
        });

        $jquery.on('click','.modal__backdrop',function(e){
            e.preventDefault();
            var div = $("#checkDomain .modal__content" );
            if ( !div.is(e.target)
                && div.has(e.target).length === 0 ) { 
                $('#checkDomain').toggleClass('modal__show', 'modal__hiding');
            }

            var link = $("#checkDomain a" );

            if ( link.is(e.target)) {
               var el = e.target;
               var next = el.getAttribute('href');
               window.location.replace(next);
            }
        });

        $jquery.on('click','.modal__btn-close',function(e){
            e.preventDefault();
            $('#checkDomain').toggleClass('modal__show', 'modal__hiding');
        });

        $('#btn-tips-pay').on('click',function(){
            $('.pay-tips').toggleClass('show close');
            $('#btn-tips-pay').toggleClass('show-arraw close-arrow');
          });
          $('#btn-tips-take').on('click',function(){
            $('.take-tips').toggleClass('show close');
            $('#btn-tips-take').toggleClass('show-arraw close-arrow');
          });
        
            $('.slider').slick({
                infinite: true,
                slidesToShow: 3,
                speed: 600,
                easing: 'ease',
                cssEase: 'ease-in',
                responsive: [
                    {
                        breakpoint: 769,
                        settings: {
                            slidesToShow: 2
                        }
                    },
                    {
                        breakpoint: 481,
                        settings: {
                            slidesToShow: 1
                        }
                    }
                ]
            });

        

        	let forms = document.querySelectorAll(".needs-validation");

            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener(
                    "submit",
                    function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault();
                            event.stopPropagation();
                            let inputs = document.querySelectorAll(".request-form__item");
                            for (let input of inputs) {
                                if (input.value === ""){
                                    $(input).removeClass('input-border');
                                    $(input).addClass('error');
                                }
                                else{
                                    $(input).removeClass('error');
                                    $(input).addClass('input-border');
                                }
                            }
                        }

                        form.classList.add("was-validated");
                    },
                    false
                );
            });

            $jquery.on("submit", "[name=feedback_email]", function (event) {
                event.preventDefault();
                let $element = $(this);
                $app.progress(function () {
                    return $ajax.request("POST", new FormData($element.get(0)), "/home/ajax/send_feedback_form").done(function ($response) {
                        $("[name=feedback_email] input, [name=feedback_email] textarea").val("");
                        $("[name=feedback_email]").removeClass("was-validated");
                        if (!$ajax.catch($response)) {
                            $('.form-btn').before('<p style="color:#82ca82">Письмо успешно отправлено!</p>');
                        }
                    });
                });
            });

    });


        let personBtn = document.querySelector(".burger-menu_img");
        let entryBtn = document.querySelector(".burger-menu_entry");

        function paintBtnImg(){
            if ( $('.modal').hasClass('modal__show') ) {
                $('.burger-menu_img').addClass('color');
                $('.burger-menu_img').removeClass('no-color');
                }
                else{
                    $('.burger-menu_img').addClass('no-color');
                $('.burger-menu_img').removeClass('color');
                }
        }
        personBtn.addEventListener("click",function(e){
            $('#checkDomain').toggleClass('modal__show', 'modal__hiding');
        paintBtnImg();
        })


        entryBtn.addEventListener("click",function(e){
            $('#checkDomain').toggleClass('modal__show', 'modal__hiding');
            paintBtnImg();
            })
    

        function burgerMenu(selector) {
            let menu = $(selector);
            let button = menu.find('.burger-menu_button', '.burger-menu_lines',);
            let links = menu.find('.burger-menu_link');
            let overlay = menu.find('.burger-menu_overlay');
            
            button.on('click', (e) => {
              e.preventDefault();
              toggleMenu();
            });
            
            links.on('click', () => toggleMenu());
            overlay.on('click', () => toggleMenu());
            
            function toggleMenu(){
              menu.toggleClass('burger-menu_active');
              toggleMenuImg();
            }
        
            function toggleMenuImg(){
                if (menu.hasClass('burger-menu_active')) {
                    $('body').css('overlow', 'hidden');
                  } else {
                    $('body').css('overlow', 'visible');
                  }
                  if (menu.hasClass('burger-menu_active')) {
                    $('.burger-menu_img').removeClass('color');
                    $('.burger-menu_img').addClass('no-color');
                  } 
                  personBtn.addEventListener("click",function(e){
                    menu.addClass('burger-menu_active');
                    menu.removeClass('burger-menu_active');
                }
                )
            }
        }
          burgerMenu('.burger-menu');

          (function () {
            if (typeof window.CustomEvent === "function") return false;
            function CustomEvent(event, params) {
                params = params || { bubbles: false, cancelable: false, detail: null };
                var evt = document.createEvent('CustomEvent');
                evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
                return evt;
            }
            window.CustomEvent = CustomEvent;
        })();